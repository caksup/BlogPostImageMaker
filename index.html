<!DOCTYPE html>
<html>
<meta charset="utf-8">

<head>
    <title>Blog Post Image Maker</title>
    <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
</head>

<body>
    <heder>
        <h2>Simple Blog Post Image Maker</h2>
    </heder>
    <br />

    <!-- text 설정 부분 -->
    <div class="textContentsArea" id="textContentsArea">
        <strong>Text:</strong></br>
        <textarea id="textContents" rows="5" cols="100">Today, I Learned 🤔</textarea>
    </div>
    <br />

    <!-- 이미지 size 및 백그라운드 컬러 설정-->
    <div class="imageOptionArea" id="imageOptionArea">
        <label for="imageWidth">Width:</label>
        <input type="number" id="imageWidth" value="700"> &nbsp;&nbsp;

        <label for="imageHeight">Height:</label>
        <input type="number" id="imageHeight" value="350"> &nbsp;&nbsp;

        <label for="imageColor">Background:</label>
        <input type="color" id="imageColor" value="#00C800"></br>

    </div>
    <br />

    <!-- 폰트 관련 설정 부분 -->
    <div class="fontOptionArea" id="fontOptionArea">
        <label for="fontSize">Font Size:</label>
        <input type="number" id="fontSize" value="40"> &nbsp;&nbsp;

        <label for="fontColor">Font Color:</label>
        <input type="color" id="fontColor" value="#FFFFFF">
    </div>
    <br />

    <!-- 미리보기 -->
    <div class="previewArea" id="previewArea">
        <strong>Preview:</strong></br>
        <svg xmlns=http://www.w3.org/2000/svg xmlns:xlink="http://www.w3.org/1999/xlink" id="imagePreview" height="200"
            width="400">

            <rect width="100%" height="100%" fill="#ffffff" id="imageBackground" />


            <text id="imageText" 
                dominant-baseline="middle" text-anchor="middle">
            </text>
            This browser doesn't support svg 🙅‍♂️
        </svg>
        </br>

        <button disabled>Download</button>
    </div>
    <br />

    <footer>
        <a href="https://github.com/jotasic/BlogPostImageMaker/">Code</a> • Made by <a
            href="https://velog.io/@burnkim61">taewoo kim</a> • Powered By <a href="https://github.com">Github</a>
    </footer>
</body>

</html>


<script type="application/javascript">
    const imageWidth = document.getElementById('imageWidth');
    const imageHeight = document.getElementById('imageHeight');
    const imageColor = document.getElementById('imageColor');
    const contents = document.getElementById('textContents');

    const fontSize = document.getElementById('fontSize');
    const fontColor = document.getElementById('fontColor');


    // 값이 변경시 updateValue 함수 호출 하도록 설정
    imageWidth.addEventListener("change", updateValue);
    imageHeight.addEventListener("change", updateValue);
    imageColor.addEventListener("change", updateValue);
    contents.addEventListener("change", updateValue);
    fontSize.addEventListener("change", updateValue);
    fontColor.addEventListener("change", updateValue);

    // 이벤트 함수
    function updateValue(e) {
        drawCanvas();
    }

    // 페이지가 로드시 실행
    window.onload = function () {

        drawCanvas();
    }


    function drawCanvas() {
        var w = imageWidth.value;
        var h = imageHeight.value;
        var c = contents.value;

        // Image View 설정
        // id가 imagePreview SVG로 변환한다.
        var imagePreview = SVG("#imagePreview");
        imagePreview.size(w, h);

        //Text Style 설정
        // id가 imageBackground SVG로 변환한다.
        var imageBackground = SVG("#imageBackground");
        imageBackground.fill(imageColor.value);

        // font 설정
        // id가 imageText를 SVG로 변환한다.
        var imageText = SVG("#imageText");
        imageText.font("weight", "bold");
        imageText.font("size", fontSize.value);
        imageText.fill(fontColor.value);


        fillTextLine(imageText, c, w / 2, h / 2);

    }

    function fillTextLine(el, text, x, y) {

        var lines = text.split("\n");
        var lineCount = lines.length;
        var fontSize = el.font("size");

        // 여려줄일 시, 시작(맨 첫줄) y좌표값을 조절 하는 작업
        var offset = (lineCount - 1) * fontSize / 2;

        el.text(function (add) {
            for (var i = 0; i < lineCount; i++)
                add.tspan(lines[i]).ax(x).ay(y + i * fontSize - offset);
        });
    }
</script>